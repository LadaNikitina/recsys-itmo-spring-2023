# Домашнее задание (Леднева Дарья)

## Основная идея эксперимента

Модификация контекстного подхода так, чтобы от пар (стартовый трек, следующий трек) перейти к триплетам (пользователь, стартовый трек, следующий трек). Таким образом, мы можем учитывать вкусы каждого пользователя в рекомендациях. Так как пар пользователь-стартовый трек очень много (порядка 50000 * 10000), сохраним полученные эмбеддинги и будем предсказывать рекомендации онлайн.

## Детали

Основную роль в реализации играют файл с препроцессингом в папке jupyter preprocessing.ipynb, где с помощью модели, идентичной используемой в контекстном подходе, учатся эмбеддинги. В файле по тройкам пользователь-первый трек-текущий трек предсказываются эмбеддинги пользователя, первого трека и кандидата-трека для рекомендации. Полученные мной эмбеддинги приложены в той же папке, это context_embeddings.npy, track_embeddings.npy и user_embeddings.npy. Подход представляет собой немного доработанный контекстный подход (от пар к триплетам плюс вместо офлайн-предсказаний используются онлайн-предсказания по пользователю и стартовому треку). Также, второй важный файл - my_recommender.py, в котором загружаются предподсчитанные эмбеддинги. На основании эмбеддингов и операций с ними составляется список из 100 рекомендаций, откуда произвольным образом выбирается рекомендуемый трек.

## Результаты A/B эксперимента

![image](https://user-images.githubusercontent.com/23546579/231861348-8ad8ff72-bd64-4964-9de7-8127c0d7907b.png)

Подробнее с результатами и логами эксперимента можно ознакомиться в папке result. В папке result находится jupyter-ноутбук Results.ipynb с результатами A/B-эксперимента, а также логи в data.json, которые загружаются в этом ноутбуке, полученные в ходе A/B-эксперимента.

## Результаты сессии

![image](https://user-images.githubusercontent.com/23546579/231864113-5692d859-766a-454d-874c-dcbeddc0830d.png)

## Ссылка на репозиторий

https://github.com/LadaNikitina/recsys-itmo-spring-2023

## Инструкция по запуску

Если хотите запустить jupyter-ноутбук с препроцессингом, необходимо скачать данные с гугл-диска.

Данные, использованные для обучения: https://drive.google.com/drive/folders/1MQg_ExaK1xLtyLIQUN6QW-6PYhqjKo8z?usp=sharing

Далее, поменять пути к данным и запустить. В ноутбуке используется gpu/cuda для обучения модели, если у вас его нет, замените gpu на cpu.

Для запуска рекоммендера убедитесь, что файлы эмбеддингов лежат там же, что и my_recommender.py, а именно в папке botify/botify/recommenders. Больше ничего не нужно, можно пользоваться!


P.S. На самом деле, я очень хотела сделать что-то с двудольным графом, где в одной доле будут вершины пользователей, в другой - вершины треков. Ребро между вершинами есть, если в наших данных пользователь прослушал трек. Тогда на ребро можно было бы поставить вес, равный времени прослушивания пользователем трека. Я хотела на этой структуре выучить информативные эмбеддинги как пользователей, так и треков через networkx/dgl и node2vec/GNN, но этот подход соверешенно не удался, сколько я бы над ним не билась. Догадываюсь, что проблема была в недостатке данных :(
